---
description: 
globs: 
alwaysApply: false
---
---
name: "SaaS VÃ©tÃ©rinaire - RÃ¨gles Principales"
type: "always"
description: "RÃ¨gles de dÃ©veloppement pour le SaaS de gestion vÃ©tÃ©rinaire avec Next.js 14, TypeScript, Supabase et Atomic Design"
---

# SaaS VÃ©tÃ©rinaire - RÃ¨gles de DÃ©veloppement

## ğŸ¯ Contexte du Projet

Tu dÃ©veloppes un SaaS moderne de gestion pour cabinets vÃ©tÃ©rinaires avec l'objectif d'atteindre 1Mâ‚¬ de CA en 3 ans. 

**Mission**: Remplacer les logiciels obsolÃ¨tes (annÃ©es 90/2000) par une interface moderne, mobile-first, Ã  prix accessible.

## ğŸ—ï¸ Stack Technique Obligatoire

### Frontend (Obligatoire)
- **Framework**: Next.js 14 avec App Router uniquement
- **Langage**: TypeScript en mode strict obligatoire  
- **Styling**: Tailwind CSS + shadcn/ui uniquement
- **State**: Zustand (global) + TanStack Query (serveur) + React Hook Form (formulaires)
- **Validation**: Zod obligatoire pour tous les schemas
- **Architecture**: Atomic Design strict

### Backend
- **Simple**: Supabase (Auth, Database, Realtime, Storage)
- **Complexe**: Symfony 7 + API Platform (logique mÃ©tier avancÃ©e)

### Services Externes
- **Paiements**: Stripe uniquement
- **Emails**: Resend
- **SMS**: Twilio  
- **PDF**: Gotenberg

## ğŸ“ Structure Atomic Design (OBLIGATOIRE)

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ atoms/           # Boutons, inputs, badges, icons
â”‚   â”œâ”€â”€ molecules/       # SearchBar, DatePicker, Cards
â”‚   â”œâ”€â”€ organisms/       # Navigation, Tables, Forms complexes
â”‚   â””â”€â”€ templates/       # Layouts de pages
â”œâ”€â”€ app/                # Pages Next.js 14 (App Router)
â”œâ”€â”€ lib/                # Utilitaires et config
â”œâ”€â”€ hooks/              # Custom hooks React
â”œâ”€â”€ stores/             # Zustand stores  
â”œâ”€â”€ schemas/            # SchÃ©mas Zod
â””â”€â”€ types/              # Types TypeScript
```

## ğŸ¨ Conventions de Code (NON-NÃ‰GOCIABLES)

### Composants React
**INTERDIT**: `React.FC<Props>` (dÃ©prÃ©ciÃ©)

**OBLIGATOIRE**: Function declaration ou arrow function avec typage direct

```typescript
// âœ… MÃ‰THODE PRÃ‰FÃ‰RÃ‰E - Function Declaration
export function Button({ variant = 'primary', children, ...props }: ButtonProps) {
  return <button className={cn(buttonVariants({ variant }))} {...props}>{children}</button>
}

// âœ… ALTERNATIVE - Arrow Function  
export const Button = ({ variant = 'primary', children, ...props }: ButtonProps) => {
  return <button className={cn(buttonVariants({ variant }))} {...props}>{children}</button>
}
```

### Nommage Strict
- **Composants**: PascalCase (`PatientCard`, `AppointmentForm`)
- **Fichiers**: kebab-case (`patient-card.tsx`, `appointment-form.tsx`)
- **Variables/Functions**: camelCase (`getCurrentPatient`, `isLoading`)
- **Constantes**: SCREAMING_SNAKE_CASE (`MAX_FILE_SIZE`)
- **Types/Interfaces**: PascalCase avec prÃ©fixe (`TPatient`, `IClinic`)

### TypeScript Obligatoire
- Mode strict activÃ©
- Types explicites pour tous les props
- Interfaces pour objets complexes, types pour unions
- Pas de `any` - utilise `unknown` si nÃ©cessaire

```typescript
// âœ… Structure type obligatoire
interface PatientCardProps {
  patient: TPatient
  onEdit?: (id: string) => void
  showActions?: boolean
}

type TPatient = {
  id: string
  name: string
  species: 'dog' | 'cat' | 'bird' | 'rabbit' | 'other'
  breed?: string
  birthDate?: Date
  weight?: number
  photos: string[]
}
```

## ğŸ¥ Domaine MÃ©tier VÃ©tÃ©rinaire

### EntitÃ©s Core (Types Obligatoires)
```typescript
interface TClinic {
  id: string
  name: string
  subscription: 'starter' | 'professional' | 'clinic'
  address: string
  phone: string
  email: string
}

interface TAnimal {
  id: string
  name: string
  species: 'dog' | 'cat' | 'bird' | 'rabbit' | 'other'
  breed?: string
  birthDate?: Date
  weight?: number
  photos: string[]
  ownerId: string
  clinicId: string
}

interface TAppointment {
  id: string
  animalId: string
  vetId: string
  scheduledAt: Date
  duration: number // minutes
  type: 'consultation' | 'surgery' | 'vaccination' | 'emergency'
  status: 'scheduled' | 'confirmed' | 'completed' | 'cancelled'
  notes?: string
}

interface TOwner {
  id: string
  firstName: string
  lastName: string
  email: string
  phone: string
  address: string
  animals: string[] // animal IDs
}
```

### FonctionnalitÃ©s Prioritaires
1. **Gestion Patients**: CRUD complet avec photos et historique
2. **Planning**: Calendrier intelligent avec rÃ©currence  
3. **Facturation**: GÃ©nÃ©ration automatique + relances
4. **Portail Client**: Prise RDV en ligne
5. **Communications**: Email/SMS automatiques
6. **Dossiers MÃ©dicaux**: Consultations + prescriptions

## ğŸ¨ UI/UX Guidelines

### Design System
- **Mobile-First**: Responsive obligatoire (tablettes = usage principal)
- **Couleurs**: Utilise les variables CSS de shadcn/ui
- **Composants**: Exclusivement shadcn/ui + personnalisation Tailwind
- **AccessibilitÃ©**: ARIA labels obligatoires, contraste WCAG AA

### Composants MÃ©tier SpÃ©cifiques
```typescript
// Exemples de composants Ã  crÃ©er
<PatientCard patient={patient} onEdit={handleEdit} />
<AppointmentSlot appointment={appointment} onReschedule={handleReschedule} />  
<VaccinationReminder animal={animal} vaccines={dueVaccines} />
<MedicalTimeline records={medicalRecords} />
<InvoicePreview invoice={invoice} onSend={handleSend} />
```

## ğŸ”§ Gestion d'Ã‰tat

### Zustand (Ã‰tat Global)
```typescript
interface AppStore {
  currentClinic: TClinic | null
  user: TUser | null
  setCurrentClinic: (clinic: TClinic) => void
  logout: () => void
}

export const useAppStore = create<AppStore>((set) => ({
  currentClinic: null,
  user: null,
  setCurrentClinic: (clinic) => set({ currentClinic: clinic }),
  logout: () => set({ currentClinic: null, user: null }),
}))
```

### TanStack Query (DonnÃ©es Serveur)
```typescript
// âœ… Structure service obligatoire
export const usePatients = (clinicId: string) => {
  return useQuery({
    queryKey: ['patients', clinicId],
    queryFn: () => patientsService.getAll(clinicId),
    enabled: !!clinicId,
  })
}
```

### React Hook Form + Zod (Formulaires)
```typescript
const patientSchema = z.object({
  name: z.string().min(1, 'Nom requis'),
  species: z.enum(['dog', 'cat', 'bird', 'rabbit', 'other']),
  weight: z.number().positive().optional(),
})

type PatientFormData = z.infer<typeof patientSchema>

// Dans le composant
const form = useForm<PatientFormData>({
  resolver: zodResolver(patientSchema),
})
```

## ğŸ”’ SÃ©curitÃ© et ConformitÃ©

### Supabase RLS (Row Level Security)
- Isolation obligatoire par `clinic_id`
- Policies strictes par rÃ´le (vÃ©tÃ©rinaire, assistant, client)
- Audit trail sur toutes les modifications sensibles

### RGPD VÃ©tÃ©rinaire
- Consentement explicite propriÃ©taires d'animaux
- Chiffrement donnÃ©es mÃ©dicales sensibles  
- Droit Ã  l'oubli implÃ©mentÃ©
- Logs d'accÃ¨s aux dossiers mÃ©dicaux

## ğŸ“± Performance et QualitÃ©

### Performance Obligatoire
- Core Web Vitals optimisÃ©s
- Images : Next.js Image avec lazy loading
- Bundle < 500kb initial
- API response < 200ms

### Tests Requis
- **Unit**: Vitest pour logique mÃ©tier
- **Components**: Testing Library  
- **E2E**: Playwright pour parcours critiques
- Coverage minimum 80% sur utils/services

### Code Quality
```bash
# Configuration obligatoire
- ESLint + Prettier
- Husky pre-commit hooks  
- TypeScript strict mode
- Conventional Commits
```

## ğŸš€ DÃ©veloppement

### Commandes Standard
```bash
npm run dev          # DÃ©veloppement local
npm run build        # Build production  
npm run test         # Tests unitaires
npm run test:e2e     # Tests end-to-end
npm run lint         # Linting
npm run type-check   # VÃ©rification types
```

### Structure de Fichier Composant
```typescript
// patient-card.tsx
import { cn } from '@/lib/utils'

interface PatientCardProps {
  patient: TPatient
  onEdit?: (id: string) => void
  className?: string
}

export function PatientCard({ patient, onEdit, className }: PatientCardProps) {
  return (
    <div className={cn('border rounded-lg p-4', className)}>
      {/* Contenu */}
    </div>
  )
}
```

## âš¡ Optimisations SpÃ©cifiques

### Images d'Animaux
- Compression automatique WebP + fallback JPEG
- Lazy loading obligatoire
- Tailles responsives multiples

### DonnÃ©es Temps RÃ©el
- Supabase Realtime pour notifications RDV
- Optimistic updates avec TanStack Query
- Offline support basique

## ğŸ¯ Erreurs Ã  Ã‰viter

âŒ **JAMAIS FAIRE**:
- Utiliser `React.FC<Props>`
- Ignorer TypeScript errors
- CSS modules ou styled-components (Tailwind only)
- Ã‰tat local pour donnÃ©es serveur (TanStack Query only)
- RequÃªtes directes Supabase dans composants (services only)

âœ… **TOUJOURS FAIRE**:
- Function declarations pour composants
- Types stricts partout
- Validation Zod sur tous les formulaires
- Services abstraits pour API calls
- Error boundaries pour composants critiques

RESPECTE STRICTEMENT CES RÃˆGLES. QualitÃ© et cohÃ©rence sont prioritaires sur la vitesse.